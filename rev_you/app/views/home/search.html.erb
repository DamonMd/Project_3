
<div id="map-canvas"></div>

<a style="color: black" href="#display-results">Check out the Results</a>
<div class="results-container">
  <p><a name="display-results"><p>
    <h2>Search Results</h2>
      <% @results.each do |result| %>
        <div class="result">
          <img id="photo" src='<%= result.image_url %>'>
          <a id="yelp-url"href='<%= result.url %>'><%= result.name %></a>
          <p><img src = "<%= result.rating_img_url %>"></p>
          <%= result.rating %>
          <p><strong>City:</strong> <%= result.location.city %></p>
          <p><strong>Number of Reviews:</strong> <%= result.review_count %></p>
          <p><%= result.snippet_text %></p>
          <!-- <p><img src="<%#= result.snippet_image_url %>"</p> -->

          <!-- These divs are purely for JS -->
          <div id="latitude" style="display:none"><%= result.location.coordinate.latitude %></div>
          <div id="longitude" style="display:none"><%= result.location.coordinate.longitude %></div>
          <div id="name" style="display:none"><%= result.name %></div>
          <div id="js-image" style="display:none"><%= result.image_url %></div>
          <div id="url" style="display:none"><%= result.url %></div>
       </div>
      <% end %>
</div>


<script type="text/javascript"
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBuf46lcqSNpCDlmoIP0BGz4d2bnG0a4rk">
</script>

<script type="text/javascript">

// var marker;
var map
// var markersArray = []
// var infoArray = []
var latitudes = document.querySelectorAll("#latitude")
var longitudes = document.querySelectorAll("#longitude")
var names = document.querySelectorAll("#name")
var images = document.querySelectorAll("#js-image")
var ratings = document.querySelectorAll("#result-rating")
var urls = document.querySelectorAll("#url")
var first_lat = latitudes[0].innerHTML
var first_long = longitudes[0].innerHTML
var infowindow



function initialize() {
  var first = new google.maps.LatLng(first_lat, first_long)
  var mapOptions = {
    zoom: 13,
    center: first,
    //this hides map controls from user
    streetViewControl: false,
    panControl: false
  }

      map = new google.maps.Map(document.getElementById('map-canvas'),mapOptions);

      // for(var i = 0; i < latitude.length; i++){
      //   var contentString = '<div class="box">' + names[i].innerHTML + '</div>'
      //   var infowindow = new google.maps.InfoWindow({content: contentString })
      //   //create a new location for the marker to drop
      //   var locale = new google.maps.LatLng(latitude[i].innerHTML, longitude[i].innerHTML)
      //   marker = new google.maps.Marker({
      //     map:map,
      //     animation: google.maps.Animation.DROP,
      //     position: locale,
      //     title: names[i].innerHTML
      //   });
      //   markersArray.push(marker)
      //   infoArray.push(infowindow)
        // google.maps.event.addListener(marker, 'click', function(){
        //   infowindow.open(map, marker)
        // });
      // }

      // markersArray.forEach(function(marker){
      //   infoArray.forEach(function(infowindow){
      //     google.maps.event.addListener(marker, 'click', function(){
      //       infowindow.open(map, marker)
      //     })
      //   })
      // })
      // for(var i = 0; i < markersArray.length; i++){
      // var testing = infoArray[i]
      //   google.maps.event.addListener(markersArray[i], 'click', function(){
      //     testing.open(map, marker)
      //   })
      // }

      infowindow = new google.maps.InfoWindow();

      for(var i = 0; i < latitude.length; i++){
        var locale = new google.maps.LatLng(latitudes[i].innerHTML, longitudes[i].innerHTML)
        var locale_name = names[i].innerHTML
        var contentString = '<a class="box" href='+urls[i].innerHTML+'><h3>' + names[i].innerHTML + '</h3></a>' +
        '<img src='+ images[i].innerHTML +'>'
        createMarker(locale, locale_name, contentString)
      }
      console.log(images[0].innerHTML)
      function createMarker(locale, locale_name, content){
        var r = new google.maps.Marker({
          map: map,
          animation: google.maps.Animation.DROP,
          position: locale,
          title: locale_name
        })

        google.maps.event.addListener(r, 'click', function() {
          infowindow.setContent(content);
          infowindow.open(map, this);
        })
        return r
      }
    }

    function toggleBounce() {
      if (marker.getAnimation() != null) {
        marker.setAnimation(null);
      } else {
        marker.setAnimation(google.maps.Animation.BOUNCE);
      }
    }

    google.maps.event.addDomListener(window, 'load', initialize);
    </script>
